(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-my-setting-updMyImg-updMyImg"],{"009a":function(t,e,i){"use strict";i("ace4"),i("a9e3"),i("d3b7"),i("ac1f"),i("3ca3"),i("466d"),i("1276"),i("5cc6"),i("9a8c"),i("a975"),i("735e"),i("c1ac"),i("d139"),i("3a7b"),i("d5d6"),i("82f8"),i("e91f"),i("60bd"),i("5f96"),i("3280"),i("3fcc"),i("ca91"),i("25a1"),i("cd26"),i("3c5d"),i("2954"),i("649e"),i("219c"),i("170b"),i("b39a"),i("72f7"),i("ddb0"),i("2b3d"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={props:{url:{type:String,default:""},fixed:{type:Boolean,default:!1},width:{type:Number,default:200},height:{type:Number,default:200},maxWidth:{type:Number,default:1024},maxHeight:{type:Number,default:1024},blob:{type:Boolean,default:!0}},data:function(){return{mask:{show:!1},frame:{left:50,top:50,width:this.width,height:this.height},image:{left:20,top:20,width:300,height:400},real:{width:100,height:100},target:{width:this.width,height:this.height},touches:[],type:"",start:{frame:{left:0,top:0,width:0,height:0},image:{left:0,top:0,width:0,height:0}},timeoutId:-1,context:null}},mounted:function(){this.$el.addEventListener("touchmove",(function(t){t.preventDefault()})),this.context=uni.createCanvasContext("canvas",this),this.targetContext=uni.createCanvasContext("target",this)},methods:{imageLoad:function(t){var e=this;this.mask.show=!0,this.real.width=t.detail.width,this.real.height=t.detail.height,this.image.width=t.detail.width,this.image.height=t.detail.height,this.frame.width=this.width,this.frame.height=this.height;var i=uni.createSelectorQuery().in(this);i.select(".body").boundingClientRect((function(t){var i=t.width,a=t.height,h=e.frame.width,o=e.frame.height,s=.8*i,n=.8*a,r=s/h,d=n/o,l=r;r<d&&(l=d),s=h*l,n=o*l;var f=(i-s)/2,c=(a-n)/2;e.frame.width=s,e.frame.height=n,e.frame.left=f,e.frame.top=c;var u=e.image.width,m=e.image.height;r=s/u,d=n/m,l=r,r<d&&(l=d),e.image.width=u*l,e.image.height=m*l,e.image.left=(i-e.image.width)/2,e.image.top=(a-e.image.height)/2,setTimeout((function(){e.trimImage()}),100)})).exec()},touchHandle:function(){},touchStart:function(t,e){this.stopTime(),this.mask.show=!1,0==this.touches.length&&(this.type=e,this.start.frame.left=this.frame.left,this.start.frame.top=this.frame.top,this.start.frame.width=this.frame.width,this.start.frame.height=this.frame.height,this.start.image.left=this.image.left,this.start.image.top=this.image.top,this.start.image.width=this.image.width,this.start.image.height=this.image.height);for(var i=t.changedTouches,a=0;a<i.length;a++){var h=i[a];this.touches[h.identifier]=h}},touchMove:function(t){this.stopTime(),t.preventDefault();var e=t.touches;if(1==this.touches.length)"plank"==this.type||"frame"==this.type||this.fixed?this.moveImage(this.touches[0],e[0]):this.scaleFrame(this.touches[0],e[0],this.type);else if(2==this.touches.length&&2==e.length){var i=this.touches[0],a=this.touches[1],h=e[0],o=e[1];if(i.identifier!=h.identifier){var s=h;h=o,o=s}this.scaleImage(i,a,h,o)}},touchEnd:function(t){this.type="",this.touches=[],this.startTime()},touchCancel:function(t){this.type="",this.touches=[],this.startTime()},startTime:function(){var t=this;this.stopTime(),this.timeoutId=setTimeout((function(){t.trimImage()}),800)},stopTime:function(){this.timeoutId>=0&&(clearTimeout(this.timeoutId),this.timeoutId=-1)},trimImage:function(){var t=this;this.mask.show=!0;var e=uni.createSelectorQuery().in(this);e.select(".body").boundingClientRect((function(e){var i=e.width,a=e.height,h=t.frame.width,o=t.frame.height,s=.8*i,n=.8*a,r=s/h,d=n/o,l=r;r>d&&(l=d),s=h*l,n=o*l;var f=(i-s)/2,c=(a-n)/2,u=f-t.frame.left,m=c-t.frame.top;t.frame.width=s,t.frame.height=n,t.frame.left=f,t.frame.top=c,t.image.width*=l,t.image.height*=l,t.image.left+=u,t.image.top+=m})).exec(),this.context.draw(!1),setTimeout((function(){var e=t.image.width/t.real.width,i=(t.frame.left-t.image.left)/e,a=(t.frame.top-t.image.top)/e,h=t.frame.width/e,o=t.frame.height/e;t.context.drawImage(t.url,i,a,h,o,0,0,t.frame.width,t.frame.height),t.context.draw(!1)}),200)},moveImage:function(t,e){var i=e.clientX-t.clientX,a=e.clientY-t.clientY;this.image.left=this.start.image.left+i,this.image.top=this.start.image.top+a,this.image.left>this.frame.left&&(this.image.left=this.frame.left),this.image.top>this.frame.top&&(this.image.top=this.frame.top),this.image.left+this.image.width<this.frame.left+this.frame.width&&(this.image.left=this.frame.left+this.frame.width-this.image.width),this.image.top+this.image.height<this.frame.top+this.frame.height&&(this.image.top=this.frame.top+this.frame.height-this.image.height)},scaleImage:function(t,e,i,a){var h=t.clientX,o=t.clientY,s=e.clientX,n=e.clientY,r=i.clientX,d=i.clientY,l=a.clientX,f=a.clientY,c=Math.sqrt((h-s)*(h-s)+(o-n)*(o-n)),u=Math.sqrt((r-l)*(r-l)+(d-f)*(d-f)),m=(h+s)/2,p=(o+n)/2,g=(r+l)/2,v=(d+f)/2,w=g-m,b=v-p,x=u/c;this.start.image.width*x<this.frame.width&&(x=this.frame.width/this.start.image.width),this.start.image.height*x<this.frame.height&&(x=this.frame.height/this.start.image.height),this.start.image.width*x<this.frame.width&&(x=this.frame.width/this.start.image.width),this.image.left=this.start.image.left+w-(m-this.start.image.left)*(x-1),this.image.top=this.start.image.top+b-(p-this.start.image.top)*(x-1),this.image.width=this.start.image.width*x,this.image.height=this.start.image.height*x,this.image.left>this.frame.left&&(this.image.left=this.frame.left),this.image.top>this.frame.top&&(this.image.top=this.frame.top),this.image.left+this.image.width<this.frame.left+this.frame.width&&(this.image.left=this.frame.left+this.frame.width-this.image.width),this.image.top+this.image.height<this.frame.top+this.frame.height&&(this.image.top=this.frame.top+this.frame.height-this.image.height)},scaleFrame:function(t,e,i){var a=e.clientX-t.clientX,h=e.clientY-t.clientY,o=this.start.frame.left,s=this.start.frame.top,n=this.start.frame.left+this.start.frame.width,r=this.start.frame.top+this.start.frame.height;"left"==i?o+=a:"right"==i?n+=a:"top"==i?s+=h:"bottom"==i?r+=h:"left-top"==i?(o+=a,s+=h):"left-bottom"==i?(o+=a,r+=h):"right-top"==i?(n+=a,s+=h):"right-bottom"==i&&(n+=a,r+=h),o<this.image.left&&(o=this.image.left),s<this.image.top&&(s=this.image.top),n>this.image.left+this.image.width&&(n=this.image.left+this.image.width),r>this.image.top+this.image.height&&(r=this.image.top+this.image.height),this.frame.left=o,this.frame.top=s,this.frame.width=n-o,this.frame.height=r-s},parseBlob:function(t){for(var e=t.split(","),i=e[0].match(/:(.*?);/)[1],a=atob(e[1]),h=a.length,o=new Uint8Array(h),s=0;s<h;s++)o[s]=a.charCodeAt(s);var n=URL||webkitURL;return n.createObjectURL(new Blob([o],{type:i}))},onok:function(){var t=this,e=this.image.width/this.real.width,i=(this.frame.left-this.image.left)/e,a=(this.frame.top-this.image.top)/e,h=this.frame.width/e,o=this.frame.height/e,s=h,n=o;if(this.fixed)s=this.width/2,n=this.height/2;else{if(s>this.maxWidth/2){var r=this.maxWidth/2/s;s*=r,n*=r}if(n>this.maxHeight/2){r=this.maxHeight/2/n;n*=r,s*=r}}this.target.width=s,this.target.height=n,setTimeout((function(){t.targetContext.drawImage(t.url,i,a,h,o,0,0,s,n),t.targetContext.draw(!1,(function(){uni.canvasToTempFilePath({canvasId:"target",success:function(e){var i=e.tempFilePath;t.blob&&(i=t.parseBlob(i)),t.$emit("ok",{path:i})}},t)}))}),100)},oncancle:function(){this.$emit("cancel")}}};e.default=a},"26ee":function(t,e,i){var a=i("24fb");e=a(!1),e.push([t.i,".ksp-image-cutter[data-v-78dc60d2]{position:absolute;width:100%;height:100%;top:0;bottom:0}.toolbar[data-v-78dc60d2]{position:absolute;width:100%;height:%?100?%;left:%?0?%;bottom:%?0?%;box-sizing:border-box;border-bottom:1px solid silver;background:#f8f8f8}.btn-cancel[data-v-78dc60d2]{position:absolute;left:%?100?%;top:%?12?%;font-size:%?30?%;line-height:%?30?%;padding:%?20?%;color:#333}.btn-ok[data-v-78dc60d2]{position:absolute;right:%?100?%;top:%?12?%;font-size:%?30?%;line-height:%?30?%;padding:%?20?%;color:#333}.body[data-v-78dc60d2]{position:absolute;left:%?0?%;right:%?0?%;top:%?0?%;bottom:%?100?%;background:#000;overflow:hidden}.mask[data-v-78dc60d2]{position:absolute;left:%?0?%;right:%?0?%;top:%?0?%;bottom:%?0?%;background:#000;opacity:.4}.plank[data-v-78dc60d2]{position:absolute;left:%?0?%;right:%?0?%;top:%?0?%;bottom:%?0?%}.image[data-v-78dc60d2]{position:absolute}.frame[data-v-78dc60d2]{position:absolute}.canvas[data-v-78dc60d2]{position:absolute;display:block;left:0;top:0}.rect[data-v-78dc60d2]{position:absolute;left:-2px;top:-2px;width:100%;height:100%;border:2px solid #fff}.line-one[data-v-78dc60d2]{position:absolute;width:100%;height:1px;background:#fff;left:0;top:33.3%}.line-two[data-v-78dc60d2]{position:absolute;width:100%;height:1px;background:#fff;left:0;top:66.7%}.line-three[data-v-78dc60d2]{position:absolute;width:1px;height:100%;background:#fff;top:0;left:33.3%}.line-four[data-v-78dc60d2]{position:absolute;width:1px;height:100%;background:#fff;top:0;left:66.7%}.frame-left[data-v-78dc60d2]{position:absolute;height:100%;width:8px;left:-4px;top:0}.frame-right[data-v-78dc60d2]{position:absolute;height:100%;width:8px;right:-4px;top:0}.frame-top[data-v-78dc60d2]{position:absolute;width:100%;height:8px;top:-4px;left:0}.frame-bottom[data-v-78dc60d2]{position:absolute;width:100%;height:8px;bottom:-4px;left:0}.frame-left-top[data-v-78dc60d2]{position:absolute;width:20px;height:20px;left:-6px;top:-6px;border-left:4px solid red;border-top:4px solid red}.frame-left-bottom[data-v-78dc60d2]{position:absolute;width:20px;height:20px;left:-6px;bottom:-6px;border-left:4px solid red;border-bottom:4px solid red}.frame-right-top[data-v-78dc60d2]{position:absolute;width:20px;height:20px;right:-6px;top:-6px;border-right:4px solid red;border-top:4px solid red}.frame-right-bottom[data-v-78dc60d2]{position:absolute;width:20px;height:20px;right:-6px;bottom:-6px;border-right:4px solid red;border-bottom:4px solid red}",""]),t.exports=e},"29c8":function(t,e,i){"use strict";i.r(e);var a=i("34f2"),h=i("8a47");for(var o in h)"default"!==o&&function(t){i.d(e,t,(function(){return h[t]}))}(o);var s,n=i("f0c5"),r=Object(n["a"])(h["default"],a["b"],a["c"],!1,null,"0cf59503",null,!1,a["a"],s);e["default"]=r.exports},"34f2":function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return h})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{},[i("v-uni-image",{staticClass:"image",attrs:{src:t.path}}),i("kps-image-cutter",{attrs:{url:t.url,fixed:!1,maxWidth:200,maxHeight:200},on:{ok:function(e){arguments[0]=e=t.$handleEvent(e),t.onok.apply(void 0,arguments)},cancel:function(e){arguments[0]=e=t.$handleEvent(e),t.oncancle.apply(void 0,arguments)}}})],1)},o=[]},"36a2":function(t,e,i){var a=i("26ee");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var h=i("4f06").default;h("234276f2",a,!0,{sourceMap:!1,shadowMode:!1})},"75e1":function(t,e,i){"use strict";var a;i.d(e,"b",(function(){return h})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return a}));var h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:t.url,expression:"url"}],staticClass:"ksp-image-cutter"},[i("v-uni-canvas",{style:{width:t.target.width+"px",height:t.target.height+"px"},attrs:{"canvas-id":"target"}}),i("v-uni-view",{staticClass:"body"},[i("v-uni-image",{staticClass:"image",style:{left:t.image.left+"px",top:t.image.top+"px",width:t.image.width+"px",height:t.image.height+"px"},attrs:{src:t.url},on:{load:function(e){arguments[0]=e=t.$handleEvent(e),t.imageLoad.apply(void 0,arguments)}}}),t.mask.show?i("v-uni-view",{staticClass:"mask"}):t._e(),i("v-uni-view",{staticClass:"plank",on:{touchstart:function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"plank")},touchmove:function(e){arguments[0]=e=t.$handleEvent(e),t.touchMove.apply(void 0,arguments)},touchend:function(e){arguments[0]=e=t.$handleEvent(e),t.touchEnd.apply(void 0,arguments)},touchcancel:function(e){arguments[0]=e=t.$handleEvent(e),t.touchCancel.apply(void 0,arguments)}}},[i("v-uni-view",{staticClass:"frame",style:{left:t.frame.left+"px",top:t.frame.top+"px",width:t.frame.width+"px",height:t.frame.height+"px"},on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"frame")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}},[i("v-uni-canvas",{directives:[{name:"show",rawName:"v-show",value:t.mask.show,expression:"mask.show"}],staticClass:"canvas",style:{width:t.frame.width+"px",height:t.frame.height+"px"},attrs:{"canvas-id":"canvas"}}),i("v-uni-view",{staticClass:"rect"}),i("v-uni-view",{staticClass:"line-one"}),i("v-uni-view",{staticClass:"line-two"}),i("v-uni-view",{staticClass:"line-three"}),i("v-uni-view",{staticClass:"line-four"}),i("v-uni-view",{staticClass:"frame-left",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"left")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-right",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"right")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-top",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"top")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-bottom",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"bottom")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-left-top",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"left-top")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-left-bottom",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"left-bottom")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-right-top",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"right-top")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}}),i("v-uni-view",{staticClass:"frame-right-bottom",on:{touchstart:[function(e){arguments[0]=e=t.$handleEvent(e),t.touchStart(e,"right-bottom")},function(e){e.stopPropagation(),e.preventDefault(),arguments[0]=e=t.$handleEvent(e),t.touchHandle.apply(void 0,arguments)}]}})],1)],1)],1),i("v-uni-view",{staticClass:"toolbar"},[i("v-uni-button",{staticClass:"btn-cancel",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.oncancle.apply(void 0,arguments)}}},[t._v("返回")]),i("v-uni-button",{staticClass:"btn-ok",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.onok.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)},o=[]},"8a47":function(t,e,i){"use strict";i.r(e);var a=i("c8b8"),h=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=h.a},c8b8:function(t,e,i){"use strict";var a=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var h=a(i("56b3")),o=a(i("d2f6")),s=a(i("97ac")),n=a(i("c0bb")),r={components:{kpsImageCutter:o.default},data:function(){return{url:"",path:"",serverUrl:"",uid:""}},onShow:function(){var t=this;this.uid=h.default.getUid(),n.default.setBarTitle("修改头像"),uni.chooseImage({success:function(e){t.url=e.tempFilePaths[0]}})},methods:{onok:function(t){var e=this;uni.showLoading({title:"正在上传头像.....",success:function(){e.path=t.path,s.default.uploadFileToCache(e.path,(function(t){e.serverUrl=t.data.url,console.log(e.serverUrl),s.default.setUser({uid:e.uid,headUrl:e.serverUrl},(function(t){var i=s.default.getCode(t);if(0===i)e.url="",uni.hideLoading(),uni.navigateBack({delta:1});else{var a=s.default.getMsg(t);uni.showToast({title:a,image:"/static/img/fail-circle.png",duration:2500}),uni.navigateBack({delta:1})}}))}))}})},oncancle:function(){this.url="",uni.navigateBack({delta:1})}}};e.default=r},d2f6:function(t,e,i){"use strict";i.r(e);var a=i("75e1"),h=i("d319");for(var o in h)"default"!==o&&function(t){i.d(e,t,(function(){return h[t]}))}(o);i("e85e");var s,n=i("f0c5"),r=Object(n["a"])(h["default"],a["b"],a["c"],!1,null,"78dc60d2",null,!1,a["a"],s);e["default"]=r.exports},d319:function(t,e,i){"use strict";i.r(e);var a=i("009a"),h=i.n(a);for(var o in a)"default"!==o&&function(t){i.d(e,t,(function(){return a[t]}))}(o);e["default"]=h.a},e85e:function(t,e,i){"use strict";var a=i("36a2"),h=i.n(a);h.a}}]);